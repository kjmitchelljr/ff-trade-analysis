<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fantasy Football Trade Log Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #f5f5f5;
        color: #212121;
      }
      .chart-container {
        position: relative;
        width: 100%;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
        height: 300px;
      }
      @media (min-width: 640px) {
        .chart-container {
          height: 350px;
        }
      }
      @media (min-width: 768px) {
        .chart-container {
          height: 400px;
        }
      }
      @media (min-width: 1024px) {
        .chart-container {
          height: 450px;
        }
      }
      .stat-card {
        background-color: #ffffff;
        border-radius: 0.5rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        padding: 1rem;
        text-align: center;
      }
      @media (min-width: 768px) {
        .stat-card {
          padding: 1.25rem;
        }
      }
      .stat-number {
        font-size: 1.5rem;
        font-weight: 700;
        color: #1b63c4;
      }
      @media (min-width: 640px) {
        .stat-number {
          font-size: 1.875rem;
        }
      }
      @media (min-width: 768px) {
        .stat-number {
          font-size: 2.25rem;
        }
      }
      .stat-label {
        font-size: 0.75rem;
        font-weight: 600;
        color: #757575;
        margin-top: 0.375rem;
      }
      @media (min-width: 768px) {
        .stat-label {
          font-size: 0.875rem;
        }
      }
      .chart-card {
        background-color: #ffffff;
        border-radius: 0.5rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        padding: 1.5rem;
      }
      .chart-title {
        font-size: 1.125rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
      }
      @media (min-width: 768px) {
        .chart-title {
          font-size: 1.25rem;
        }
      }
      .chart-context {
        font-size: 0.8125rem;
        color: #757575;
        margin-bottom: 1rem;
        line-height: 1.4;
      }
      @media (min-width: 768px) {
        .chart-context {
          font-size: 0.875rem;
        }
      }
      /* Desktop table styles - bold traded players */
      @media (min-width: 768px) {
        .trade-table tbody td[data-label="Traded"] {
          font-weight: 600;
        }
      }
      /* Mobile table styles */
      @media (max-width: 767px) {
        .trade-table thead {
          display: none;
        }
        .trade-table tbody tr {
          display: block;
          margin-bottom: 1rem;
          border: 1px solid #e5e7eb;
          border-radius: 0.5rem;
          padding: 0.75rem;
        }
        .trade-table tbody tr.bg-red-50 {
          background-color: #fef2f2;
          border-color: #fca5a5;
        }
        .trade-table tbody tr.bg-purple-50 {
          background-color: #faf5ff;
          border-left: 4px solid #a855f7;
        }
        .trade-table tbody td {
          display: block;
          text-align: left;
          padding: 0.375rem 0 !important;
          border: none;
        }
        .trade-table tbody td:before {
          content: attr(data-label);
          font-weight: 600;
          font-size: 0.625rem;
          text-transform: uppercase;
          color: #6b7280;
          display: block;
          margin-bottom: 0.125rem;
        }
        /* Highlight traded players on mobile */
        .trade-table tbody td[data-label="Traded"] {
          background-color: #eff6ff;
          border-left: 3px solid #3b82f6;
          padding: 0.5rem !important;
          margin: 0.25rem 0;
          border-radius: 0.375rem;
          font-weight: 500;
        }
        .trade-table tbody tr.bg-red-50 td[data-label="Traded"] {
          background-color: #fee2e2;
          border-left-color: #ef4444;
        }
        .trade-table tbody tr.bg-purple-50 td[data-label="Traded"] {
          background-color: #f3e8ff;
          border-left-color: #a855f7;
        }
      }
    </style>
  </head>
  <body>
    <header class="bg-white shadow-md">
      <div class="container mx-auto px-4 py-4 md:py-6">
        <h1 class="text-2xl md:text-3xl font-bold text-center text-[#00449E]">
          Putin & The Runner Ups
        </h1>
        <h2
          class="text-lg md:text-xl font-semibold text-center text-[#757575] mt-1"
        >
          Trade Activity Analysis (Sep - Nov 2025)
        </h2>
      </div>
    </header>

    <main class="container mx-auto p-4 md:p-8">
      <section id="kpis" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="stat-card">
          <div class="stat-number" id="totalTrades">0</div>
          <div class="stat-label">Total Trades Processed</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="totalPlayers">0</div>
          <div class="stat-label">Total Players Exchanged</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="busiestMonth">-</div>
          <div class="stat-label" id="busiestMonthLabel">
            Busiest Trade Month
          </div>
        </div>
      </section>

      <section id="trade-log" class="chart-card mb-8">
        <h3 class="chart-title">Complete Processed Trade Log</h3>
        <p class="chart-context" id="tradeLogDescription">
          A detailed list of all processed trades for reference.
        </p>
        <div class="overflow-x-auto">
          <table class="trade-table min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th
                  scope="col"
                  class="px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                >
                  Date
                </th>
                <th
                  scope="col"
                  class="px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                >
                  Team 1
                </th>
                <th
                  scope="col"
                  class="px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                >
                  Traded
                </th>
                <th
                  scope="col"
                  class="px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                >
                  Team 2
                </th>
                <th
                  scope="col"
                  class="px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                >
                  Traded
                </th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <tr>
                <td
                  data-label="Date"
                  class="px-3 md:px-6 py-3 md:py-4 whitespace-nowrap text-xs md:text-sm"
                >
                  Sep 10
                </td>
                <td
                  data-label="Team 1"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm font-medium"
                >
                  F.N. GOODELL
                </td>
                <td
                  data-label="Traded"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm"
                >
                  Isiah Pacheco (WR), Jordan Mason (RB)
                </td>
                <td
                  data-label="Team 2"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm font-medium"
                >
                  Winter Soldier
                </td>
                <td
                  data-label="Traded"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm"
                >
                  Terry McLaurin (WR), Stefon Diggs (WR), Calvin Ridley (WR)
                </td>
              </tr>
              <tr>
                <td
                  data-label="Date"
                  class="px-3 md:px-6 py-3 md:py-4 whitespace-nowrap text-xs md:text-sm"
                >
                  Sep 16
                </td>
                <td
                  data-label="Team 1"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm font-medium"
                >
                  More To Life..
                </td>
                <td
                  data-label="Traded"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm"
                >
                  Evan McPherson (K), Jake Ferguson (TE)
                </td>
                <td
                  data-label="Team 2"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm font-medium"
                >
                  Winter Soldier
                </td>
                <td
                  data-label="Traded"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm"
                >
                  Dyami Brown (WR), Cam Little (K)
                </td>
              </tr>
              <tr>
                <td
                  data-label="Date"
                  class="px-3 md:px-6 py-3 md:py-4 whitespace-nowrap text-xs md:text-sm"
                >
                  Sep 17
                </td>
                <td
                  data-label="Team 1"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm font-medium"
                >
                  Chase A Check..
                </td>
                <td
                  data-label="Traded"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm"
                >
                  Jerry Jeudy (WR)
                </td>
                <td
                  data-label="Team 2"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm font-medium"
                >
                  ..
                </td>
                <td
                  data-label="Traded"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm"
                >
                  Nick Chubb (RB), Chig Okonkwo (TE)
                </td>
              </tr>
              <tr>
                <td
                  data-label="Date"
                  class="px-3 md:px-6 py-3 md:py-4 whitespace-nowrap text-xs md:text-sm"
                >
                  Sep 18
                </td>
                <td
                  data-label="Team 1"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm font-medium"
                >
                  For Emma
                </td>
                <td
                  data-label="Traded"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm"
                >
                  Keenan Allen (WR)
                </td>
                <td
                  data-label="Team 2"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm font-medium"
                >
                  More To Life..
                </td>
                <td
                  data-label="Traded"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm"
                >
                  Jordan Love (QB)
                </td>
              </tr>
              <tr>
                <td
                  data-label="Date"
                  class="px-3 md:px-6 py-3 md:py-4 whitespace-nowrap text-xs md:text-sm"
                >
                  Sep 25
                </td>
                <td
                  data-label="Team 1"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm font-medium"
                >
                  Nabers..
                </td>
                <td
                  data-label="Traded"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm"
                >
                  Alvin Kamara (RB), David Njoku (TE), Matthew Golden (WR)
                </td>
                <td
                  data-label="Team 2"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm font-medium"
                >
                  Winter Soldier
                </td>
                <td
                  data-label="Traded"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm"
                >
                  Stefon Diggs (WR), Jake Ferguson (TE), Chuba Hubbard (RB)
                </td>
              </tr>
              <tr>
                <td
                  data-label="Date"
                  class="px-3 md:px-6 py-3 md:py-4 whitespace-nowrap text-xs md:text-sm"
                >
                  Oct 8
                </td>
                <td
                  data-label="Team 1"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm font-medium"
                >
                  More To Life..
                </td>
                <td
                  data-label="Traded"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm"
                >
                  Tee Higgins (WR)
                </td>
                <td
                  data-label="Team 2"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm font-medium"
                >
                  Walk Em Down
                </td>
                <td
                  data-label="Traded"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm"
                >
                  Tony Pollard (RB)
                </td>
              </tr>
              <tr>
                <td
                  data-label="Date"
                  class="px-3 md:px-6 py-3 md:py-4 whitespace-nowrap text-xs md:text-sm"
                >
                  Oct 24
                </td>
                <td
                  data-label="Team 1"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm font-medium"
                >
                  The Runners
                </td>
                <td
                  data-label="Traded"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm"
                >
                  Khalil Shakir (WR)
                </td>
                <td
                  data-label="Team 2"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm font-medium"
                >
                  High Noon FC
                </td>
                <td
                  data-label="Traded"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm"
                >
                  RJ Harvey (RB)
                </td>
              </tr>
              <tr>
                <td
                  data-label="Date"
                  class="px-3 md:px-6 py-3 md:py-4 whitespace-nowrap text-xs md:text-sm"
                >
                  Oct 28
                </td>
                <td
                  data-label="Team 1"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm font-medium"
                >
                  Winter Soldier
                </td>
                <td
                  data-label="Traded"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm"
                >
                  Jordan Mason (RB)
                </td>
                <td
                  data-label="Team 2"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm font-medium"
                >
                  One Man Army
                </td>
                <td
                  data-label="Traded"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm"
                >
                  Josh Downs (WR)
                </td>
              </tr>
              <tr class="bg-red-50">
                <td
                  data-label="Date"
                  class="px-3 md:px-6 py-3 md:py-4 whitespace-nowrap text-xs md:text-sm text-red-600"
                >
                  Oct 28
                </td>
                <td
                  data-label="Team 1"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm font-medium text-red-600"
                >
                  The Runners
                </td>
                <td
                  data-label="Traded"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm text-red-600"
                >
                  RJ Harvey (RB)
                </td>
                <td
                  data-label="Team 2"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm font-medium text-red-600"
                >
                  High Noon FC
                </td>
                <td
                  data-label="Traded"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm text-red-600"
                >
                  Khalil Shakir (WR)
                  <span
                    class="ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800"
                  >
                    VETOED
                  </span>
                </td>
              </tr>
              <tr>
                <td
                  data-label="Date"
                  class="px-3 md:px-6 py-3 md:py-4 whitespace-nowrap text-xs md:text-sm"
                >
                  Oct 30
                </td>
                <td
                  data-label="Team 1"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm font-medium"
                >
                  Nabers..
                </td>
                <td
                  data-label="Traded"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm"
                >
                  Caleb Williams (QB)
                </td>
                <td
                  data-label="Team 2"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm font-medium"
                >
                  Winter Soldier
                </td>
                <td
                  data-label="Traded"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm"
                >
                  Chimere Dike (WR)
                </td>
              </tr>
              <tr>
                <td
                  data-label="Date"
                  class="px-3 md:px-6 py-3 md:py-4 whitespace-nowrap text-xs md:text-sm"
                >
                  Oct 30
                </td>
                <td
                  data-label="Team 1"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm font-medium"
                >
                  Romans 8:31
                </td>
                <td
                  data-label="Traded"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm"
                >
                  Chase Brown (RB)
                </td>
                <td
                  data-label="Team 2"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm font-medium"
                >
                  F.N. GOODELL
                </td>
                <td
                  data-label="Traded"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm"
                >
                  Jaylen Warren (RB)
                </td>
              </tr>
              <tr class="bg-purple-50 border-l-4 border-purple-500">
                <td
                  data-label="Date"
                  class="px-3 md:px-6 py-3 md:py-4 whitespace-nowrap text-xs md:text-sm text-purple-900"
                >
                  Oct 31
                </td>
                <td
                  data-label="Team 1"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm font-medium text-purple-900"
                >
                  Romans 8:31
                </td>
                <td
                  data-label="Traded"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm text-purple-900"
                >
                  Tyler Allgeier (RB), Drake London (WR)
                </td>
                <td
                  data-label="Team 2"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm font-medium text-purple-900"
                >
                  One Man Army
                </td>
                <td
                  data-label="Traded"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm text-purple-900"
                >
                  Chris Olave (WR)
                  <span
                    class="ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-purple-200 text-purple-900"
                  >
                    + $37 FAB
                  </span>
                </td>
              </tr>
              <tr class="bg-purple-50 border-l-4 border-purple-500">
                <td
                  data-label="Date"
                  class="px-3 md:px-6 py-3 md:py-4 whitespace-nowrap text-xs md:text-sm text-purple-900"
                >
                  Oct 31
                </td>
                <td
                  data-label="Team 1"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm font-medium text-purple-900"
                >
                  F.N. GOODELL
                </td>
                <td
                  data-label="Traded"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm text-purple-900"
                >
                  Deebo Samuel (WR)
                </td>
                <td
                  data-label="Team 2"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm font-medium text-purple-900"
                >
                  Romans 8:31
                </td>
                <td
                  data-label="Traded"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm text-purple-900"
                ></td>
              </tr>
              <tr class="bg-purple-50 border-l-4 border-purple-500">
                <td
                  data-label="Date"
                  class="px-3 md:px-6 py-3 md:py-4 whitespace-nowrap text-xs md:text-sm text-purple-900"
                >
                  Nov 1
                </td>
                <td
                  data-label="Team 1"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm font-medium text-purple-900"
                >
                  F.N. GOODELL
                </td>
                <td
                  data-label="Traded"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm text-purple-900"
                ></td>
                <td
                  data-label="Team 2"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm font-medium text-purple-900"
                >
                  One Man Army
                </td>
                <td
                  data-label="Traded"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm text-purple-900"
                >
                  Tyrone Tracy Jr. (RB)
                  <span
                    class="ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-purple-200 text-purple-900"
                  >
                    3-WAY TRADE
                  </span>
                </td>
              </tr>
              <tr>
                <td
                  data-label="Date"
                  class="px-3 md:px-6 py-3 md:py-4 whitespace-nowrap text-xs md:text-sm"
                >
                  Nov 3
                </td>
                <td
                  data-label="Team 1"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm font-medium"
                >
                  The Runners
                </td>
                <td
                  data-label="Traded"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm"
                >
                  Jaylen Waddle (WR)
                </td>
                <td
                  data-label="Team 2"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm font-medium"
                >
                  ..
                </td>
                <td
                  data-label="Traded"
                  class="px-3 md:px-6 py-3 md:py-4 text-xs md:text-sm"
                >
                  Kenneth Walker III (RB), Troy Franklin (WR)
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <section
        id="charts-grid"
        class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8"
      >
        <div class="chart-card">
          <h3 class="chart-title">When Did the Trading Happen?</h3>
          <p class="chart-context">
            This chart shows the total number of processed trades each month,
            highlighting the mid-season trade deadline push.
          </p>
          <div class="chart-container">
            <canvas id="tradesPerMonthChart"></canvas>
          </div>
        </div>

        <div class="chart-card">
          <h3 class="chart-title">Who Were the Most Active Teams?</h3>
          <p class="chart-context">
            This chart ranks teams by their total involvement in trades (both
            sending and receiving players).
          </p>
          <div class="chart-container">
            <canvas id="activeTeamsChart"></canvas>
          </div>
        </div>
      </section>

      <section class="chart-card mb-8">
        <h3 class="chart-title">Player Position Breakdown</h3>
        <p class="chart-context">
          Distribution of all traded players by position, showing which
          positions are most frequently involved in trades.
        </p>
        <div class="chart-container" style="max-width: 400px">
          <canvas id="positionChart"></canvas>
        </div>
      </section>
    </main>

    <footer class="text-center p-4 mt-8">
      <p class="text-xs text-gray-500">
        Infographic generated based on trade log data. This is a single-page
        application using Chart.js and Tailwind CSS. No SVG or Mermaid JS
        elements were used in the creation of this page.
      </p>
    </footer>

    <script>
      window.addEventListener("DOMContentLoaded", () => {
        // Calculate total trades and players from the table
        const tradeRows = document.querySelectorAll(
          ".trade-table tbody tr:not(.bg-red-50)"
        );
        const totalTrades = tradeRows.length;

        let totalPlayers = 0;
        tradeRows.forEach((row) => {
          const tradedCells = row.querySelectorAll('td[data-label="Traded"]');
          tradedCells.forEach((cell) => {
            const text = cell.textContent.trim();
            if (text) {
              // Count players by splitting on commas
              const players = text.split(",").filter((p) => {
                const trimmed = p.trim();
                // Filter out badge text like "VETOED" or "3-WAY TRADE" or "+ $37 FAB"
                return (
                  trimmed &&
                  !trimmed.includes("VETOED") &&
                  !trimmed.includes("3-WAY") &&
                  !trimmed.startsWith("+")
                );
              });
              totalPlayers += players.length;
            }
          });
        });

        // Calculate busiest month
        const monthCounts = {};
        const monthNames = {
          Sep: "September",
          Oct: "October",
          Nov: "November",
        };

        tradeRows.forEach((row) => {
          const dateCell = row.querySelector('td[data-label="Date"]');
          if (dateCell) {
            const dateText = dateCell.textContent.trim();
            const month = dateText.split(" ")[0]; // Get 'Sep', 'Oct', or 'Nov'
            monthCounts[month] = (monthCounts[month] || 0) + 1;
          }
        });

        // Find the busiest month
        let busiestMonth = "";
        let maxTrades = 0;
        for (const [month, count] of Object.entries(monthCounts)) {
          if (count > maxTrades) {
            maxTrades = count;
            busiestMonth = month;
          }
        }

        // Update the KPI displays
        document.getElementById("totalTrades").textContent = totalTrades;
        document.getElementById("totalPlayers").textContent = totalPlayers;
        document.getElementById("busiestMonth").textContent =
          monthNames[busiestMonth] || "-";
        document.getElementById(
          "busiestMonthLabel"
        ).textContent = `Busiest Trade Month (${maxTrades} Trade${
          maxTrades !== 1 ? "s" : ""
        })`;

        // Update trade log description
        document.getElementById(
          "tradeLogDescription"
        ).textContent = `A detailed list of all ${totalTrades} processed trade${
          totalTrades !== 1 ? "s" : ""
        } for reference.`;

        // Calculate team trade activity from table
        const teamTradeCount = {};
        tradeRows.forEach((row) => {
          const team1Cell = row.querySelector('td[data-label="Team 1"]');
          const team2Cell = row.querySelector('td[data-label="Team 2"]');

          if (team1Cell) {
            const team1 = team1Cell.textContent.trim();
            teamTradeCount[team1] = (teamTradeCount[team1] || 0) + 1;
          }

          if (team2Cell) {
            const team2 = team2Cell.textContent.trim();
            teamTradeCount[team2] = (teamTradeCount[team2] || 0) + 1;
          }
        });

        // Sort teams by trade count (descending)
        const sortedTeams = Object.entries(teamTradeCount)
          .sort((a, b) => b[1] - a[1])
          .filter(([team, count]) => count > 0); // Only include teams with trades

        const teamLabels = sortedTeams.map(([team]) => team);
        const teamCounts = sortedTeams.map(([, count]) => count);

        // Generate colors for teams
        const teamColors = [
          "#00449E",
          "#1B63C4",
          "#FFC100",
          "#FF8F00",
          "#FF5722",
          "#757575",
          "#4CAF50",
          "#9C27B0",
          "#E91E63",
          "#00BCD4",
          "#8BC34A",
          "#FF9800",
          "#607D8B",
          "#795548",
          "#9E9E9E",
          "#673AB7",
        ];

        const palette = {
          blue1: "#00449E",
          blue2: "#1B63C4",
          yellow: "#FFC100",
          orange: "#FF8F00",
          deepOrange: "#FF5722",
          gray: "#757575",
        };

        const tooltipTitleCallback = {
          plugins: {
            tooltip: {
              callbacks: {
                title: function (tooltipItems) {
                  const item = tooltipItems[0];
                  let label = item.chart.data.labels[item.dataIndex];
                  if (Array.isArray(label)) {
                    return label.join(" ");
                  } else {
                    return label;
                  }
                },
              },
            },
          },
        };

        function wrapLabel(label, maxWidth = 16) {
          if (typeof label !== "string" || label.length <= maxWidth) {
            return label;
          }
          const words = label.split(" ");
          const lines = [];
          let currentLine = "";
          for (const word of words) {
            if (
              (currentLine + word).length > maxWidth &&
              currentLine.length > 0
            ) {
              lines.push(currentLine.trim());
              currentLine = word + " ";
            } else {
              currentLine += word + " ";
            }
          }
          if (currentLine.length > 0) {
            lines.push(currentLine.trim());
          }
          return lines;
        }

        // Prepare data for trades per month chart
        const monthLabels = Object.keys(monthNames).map(
          (abbr) => monthNames[abbr]
        );
        const monthData = monthLabels.map((fullName, idx) => {
          const abbr = Object.keys(monthNames)[idx];
          return monthCounts[abbr] || 0;
        });

        const tradesPerMonthCtx = document
          .getElementById("tradesPerMonthChart")
          .getContext("2d");
        new Chart(tradesPerMonthCtx, {
          type: "bar",
          data: {
            labels: monthLabels,
            datasets: [
              {
                label: "Trades per Month",
                data: monthData,
                backgroundColor: [palette.blue2, palette.blue1, palette.yellow],
                borderColor: "#ffffff",
                borderWidth: 1,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  stepSize: 1,
                },
              },
            },
            ...tooltipTitleCallback,
          },
        });

        const activeTeamsCtx = document
          .getElementById("activeTeamsChart")
          .getContext("2d");
        new Chart(activeTeamsCtx, {
          type: "bar",
          data: {
            labels: teamLabels,
            datasets: [
              {
                label: "Number of Trades Involved In",
                data: teamCounts,
                backgroundColor: teamColors.slice(0, teamLabels.length),
              },
            ],
          },
          options: {
            indexAxis: "y",
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              x: {
                ticks: {
                  stepSize: 1,
                },
              },
              y: {
                ticks: {
                  autoSkip: false,
                  font: {
                    size: 9,
                  },
                },
              },
            },
            plugins: {
              ...tooltipTitleCallback.plugins,
              legend: {
                display: false,
              },
            },
          },
        });

        // Calculate position breakdown
        const positionCounts = {
          RB: 0,
          WR: 0,
          QB: 0,
          TE: 0,
          K: 0,
        };

        tradeRows.forEach((row) => {
          const tradedCells = row.querySelectorAll('td[data-label="Traded"]');
          tradedCells.forEach((cell) => {
            const text = cell.textContent.trim();
            if (text) {
              // Match positions in parentheses like (RB), (WR), etc.
              const positionMatches = text.match(/\((RB|WR|QB|TE|K)\)/g);
              if (positionMatches) {
                positionMatches.forEach((match) => {
                  const position = match.replace(/[()]/g, "");
                  if (positionCounts[position] !== undefined) {
                    positionCounts[position]++;
                  }
                });
              }
            }
          });
        });

        // Prepare data for position chart
        const positionLabels = Object.keys(positionCounts);
        const positionData = Object.values(positionCounts);

        const positionCtx = document
          .getElementById("positionChart")
          .getContext("2d");
        new Chart(positionCtx, {
          type: "doughnut",
          data: {
            labels: positionLabels,
            datasets: [
              {
                label: "Players Traded",
                data: positionData,
                backgroundColor: [
                  palette.blue1, // RB
                  palette.blue2, // WR
                  palette.yellow, // QB
                  palette.orange, // TE
                  palette.gray, // K
                ],
                borderColor: "#ffffff",
                borderWidth: 2,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: "bottom",
                labels: {
                  padding: 15,
                  font: {
                    size: 12,
                  },
                },
              },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    const label = context.label || "";
                    const value = context.parsed || 0;
                    const total = context.dataset.data.reduce(
                      (a, b) => a + b,
                      0
                    );
                    const percentage = ((value / total) * 100).toFixed(1);
                    return `${label}: ${value} players (${percentage}%)`;
                  },
                },
              },
            },
          },
        });
      });
    </script>
  </body>
</html>
